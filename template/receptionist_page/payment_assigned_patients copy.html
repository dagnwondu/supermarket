{% extends 'reception_page/reception_base.html' %} {% block content %}
<h6>Welcome: {{ user.first_name }}</h6>
<h5 style="text-align: center">Payments</h5>

{% if messages %}
<div class="alert alert-info">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }}</div>
  {% endfor %}
</div>
{% endif %} {% if payments %}
<div class="container-fluid">
  <div class="col">
    <table class="table table-striped table-hover table-bordered">
      <thead>
        <tr>
          <th scope="col">S.No</th>
          <th scope="col">Full Name</th>
          <th>Total Amount</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for patient in payments %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ patient.patient__full_name }}</td>
          <td>{{ patient.total_amount|floatformat:2 }}</td>
          <td>
            <!-- Trigger modal on button click -->
            <button
              type="button"
              class="btn btn-success"
              data-toggle="modal"
              data-target="#paymentModal"
              data-patient-name="{{ patient.patient__full_name }}"
              data-patient-id="{{ patient.patient_id }}"
              data-amount="{{ patient.total_amount|floatformat:2 }}"
            >
              Confirm Payment
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="container">
  <p>No assigned payments found.</p>
</div>
{% endif %}

<!-- Modal for payment confirmation -->
<div
  class="modal fade"
  id="paymentModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="paymentModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel">Confirm Payment</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Patient: <span id="modal-patient-name"></span></p>
        <p>Total Amount: <span id="modal-amount"></span></p>
        <p>Are you sure you want to confirm this payment?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Cancel
        </button>
        <a id="confirm-payment-btn" href="#" class="btn btn-primary"
          >Confirm Payment</a
        >
      </div>
    </div>
  </div>
</div>

{% block extra_js %}
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

<script>
  // jQuery to handle the modal data
  $("#paymentModal").on("show.bs.modal", function (event) {
    var button = $(event.relatedTarget); // Button that triggered the modal
    var patientName = button.data("patient-name"); // Extract data-* attributes
    var patientId = button.data("patient-id");
    var amount = button.data("amount");

    var modal = $(this);
    modal.find("#modal-patient-name").text(patientName); // Set patient name in modal
    modal.find("#modal-amount").text(amount); // Set amount in modal

    // Set the Confirm Payment button link dynamically with patientId
    modal
      .find("#confirm-payment-btn")
      .attr(
        "href",
        "{% url 'success_payment' patient_id=0 %}".replace("0", patientId)
      );
  });
</script>
{% endblock %} {% endblock %}
