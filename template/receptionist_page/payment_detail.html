{% extends 'receptionist_page/receptionist_base.html' %} {% block content %}

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card border-0 shadow rounded-4 p-4">
        <div class="text-center mb-4">
          <h4 class="text-success fw-bold">
            <i class="fas fa-money-check-alt me-2"></i> Confirm Payment
          </h4>
          <p class="mb-0 fs-5">
            Patient: <strong>{{ patient.full_name }}</strong>
          </p>
        </div>

        {% if pending_lab_results or pending_imaging_results %}
        <div class="table-responsive mb-4">
          <table class="table table-bordered align-middle">
            <thead class="table-light">
              <tr class="text-center">
                <th>#</th>
                <th>Investigation Type</th>
                <th>Investigation</th>
                <th>Price (Birr)</th>
              </tr>
            </thead>
            <tbody>
              {% for result in pending_lab_results %}
              <tr>
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-center">Lab</td>
                <td>{{ result.investigation_name.name }}</td>
                <td class="text-end">
                  {{ result.investigation_name.price|floatformat:2 }}
                </td>
              </tr>
              {% endfor %} {% for result in pending_imaging_results %}
              <tr>
                <td class="text-center">
                  {{ forloop.counter|add:pending_lab_results|length }}
                </td>
                <td class="text-center">Imaging</td>
                <td>{{ result.investigation_name.name }}</td>
                <td class="text-end">
                  {{ result.investigation_name.price|floatformat:2 }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="text-center mb-4">
          <h5 class="text-danger fw-bold">
            Total Price: {{ total_price|floatformat:2 }} Birr
          </h5>
        </div>

        <form
          method="POST"
          action="{% url 'success_payment' patient.id %}"
          id="payment-form"
        >
          {% csrf_token %}
          <div class="d-flex justify-content-center gap-3">
            <a
              href="{% url 'pending_orders' %}"
              class="btn btn-outline-secondary"
            >
              <i class="fas fa-arrow-left me-1"></i> Cancel
            </a>
            <button
              type="submit"
              class="btn btn-success"
              onclick="return confirmPayment();"
            >
              <i class="fas fa-check-circle me-1"></i> Confirm & Pay
            </button>
          </div>
        </form>

        {% else %}
        <div class="alert alert-info text-center mt-4">
          <i class="fas fa-info-circle me-2"></i> No pending investigations for
          this patient.
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
  function confirmPayment() {
    const confirmed = confirm("Are you sure you want to confirm this payment?");
    if (confirmed) {
      document.querySelector('button[type="submit"]').disabled = true;
    }
    return confirmed;
  }
</script>

{% endblock %}
