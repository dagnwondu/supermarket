{% extends 'receptionist_page/receptionist_base.html' %} {% block content %}

{% if messages %}
<div class="alert alert-info">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }}</div>
  {% endfor %}
</div>
{% endif %}

<h6>Welcome: {{ user.first_name }}</h6>


<div class="container mt-4">
  <h4 class="mb-3">üìÖ Scheduled Appointments</h4>

  <!-- Search bar -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
      <input type="text" name="q" class="form-control form-control-md"
             placeholder="Search by patient or doctor..." value="{{ request.GET.q }}">
    </div>
    <div class="col-md-3">
      <input type="date" name="date" class="form-control form-control-md"
             value="{{ request.GET.date }}">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">üîç Search</button>
    </div>
    <div class="col-md-2">
      <a href="{% url 'appointments' %}" class="btn btn-secondary w-100">‚Üª Reset</a>
    </div>
  </form>

  <!-- Appointment Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-hover table-striped mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Patient</th>
            <th>Doctor</th>
            <th>Date & Time</th>
            <th>Type</th>
            <th>Status</th>
            <th>Reason</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr>
            <td>{{ forloop.counter}}</td>
            <td>{{ appointment.medical_record.patient.full_name }}</td>
            <td>
              {% if appointment.doctor %}
                 {{ appointment.doctor.get_full_name }}
              {% else %}
                <span class="text-muted">‚Äî</span>
              {% endif %}
            </td>
            <td>{{ appointment.appointment_date|date:"Y-m-d H:i" }}</td>
            <td>{{ appointment.appointment_type }}</td>
            <td>
              {% if appointment.status == "Scheduled" %}
                <span class="badge bg-warning text-dark">Scheduled</span>
              {% else %}
                <span class="badge bg-success">Completed</span>
              {% endif %}
            </td>
            <td>{{ appointment.reason|default:"‚Äî" }}</td>
            <td>
              <a href="{% url 'create_appointment' appointment.medical_record.patient.id %}"
                 class="btn btn-outline-success btn-sm">Reschedule</a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="text-center text-muted py-3">
              No appointments found.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  {% if appointments.has_other_pages %}
  <nav aria-label="Appointments pagination" class="mt-3">
    <ul class="pagination justify-content-center">
      {% if appointments.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1">&laquo; First</a></li>
        <li class="page-item">
          <a class="page-link" href="?page={{ appointments.previous_page_number }}">‚Äπ Prev</a>
        </li>
      {% endif %}

      {% for num in appointments.paginator.page_range %}
        {% if appointments.number == num %}
          <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
        {% elif num > appointments.number|add:'-3' and num < appointments.number|add:'3' %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}

      {% if appointments.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ appointments.next_page_number }}">Next ‚Ä∫</a>
        </li>
        <li class="page-item"><a class="page-link" href="?page={{ appointments.paginator.num_pages }}">Last &raquo;</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>

{% endblock %}
