{% extends 'doctor_page/doctor_base.html' %} {% block content %}
<style>
  .custom-table {
    width: 100%;
    max-width: 960px;
    margin: auto;
    table-layout: fixed;
    border-collapse: separate;
    border-spacing: 20px 10px;
  }

  .custom-table td {
    position: relative;
    background-color: #f8f9fa;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
  }

  .custom-table .hover-detail {
    display: none;
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translate(-50%, -10px);
    width: 100%;
    background-color: #fff;
    border: 1px solid #ccc;
    padding: 8px;
    border-radius: 6px;
    z-index: 10;
    white-space: normal;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  }

  .custom-table td:hover .hover-detail {
    display: block;
  }
</style>

<style>
  p {
    text-align: center;
  }
</style>

<!-- Patient Information -->
<div class="container-fluid my-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-white text-primary text-center fw-bold border-0">
      <h4 class="mb-0">
        <i class="fas fa-user-md me-2">Patient Information</i>
      </h4>
    </div>

    <div class="card-body">
      <h5 class="text-center  fw-bold mb-4">
        {{ patient.full_name }}
      </h5>

      <div class="row text-center">
        <!-- Left Column -->
        <div class="col-md-6 mb-3">
          <p class="card-text mb-2">
            <i class="fas fa-birthday-cake text-danger me-2"></i>
            <strong>Age:</strong> {{ patient.age }}
          </p>
          <p class="card-text mb-0">
            <i class="fas fa-venus-mars text-info me-2"></i>
            <strong>Gender:</strong> {{ patient.gender }}
          </p>
        </div>

        <!-- Right Column -->
        <div class="col-md-6 mb-3">
          <p class="card-text mb-2">
            <i class="fas fa-clock text-warning me-2"></i>
            <strong>Time Assigned:</strong> {{ time_assigned }}
          </p>
          <p class="card-text mb-0">
            <i class="fas fa-id-card text-success me-2"></i>
            <strong>MRN:</strong> {{ patient.card_number }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Previous Medical History -->
{% if medical_history %}
<div class="container-fluid my-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-white text-center border-0">
      <h4 class="text-primary fw-bold mb-0">
        <i class="bi bi-journal-medical me-2"></i>Medical History
      </h4>
    </div>

    <div class="card-body text-center">
      <a 
        href="{% url 'medical_history' patient.id %}" 
        target="_blank" 
        class="text-info text-decoration-none fw-semibold d-inline-flex align-items-center gap-2 hover-opacity"
      >
        <i class="bi bi-journal-medical fs-5"></i>
        See Previous Medical History
        <i class="bi bi-hand-index-thumb fs-5 animate-bounce"></i>
      </a>
    </div>
  </div>
</div>
{% else %}
<div class="container-fluid my-4">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body text-center text-danger fw-semibold">
      <i class="bi bi-exclamation-triangle me-2"></i>
      No previous medical history found for {{ patient.full_name }}.
    </div>
  </div>
</div>
{% endif %}

<!-- Vital Signs Section -->
<div class="container-fluid my-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-white text-center border-0">
      <h4 class="text-primary fw-bold mb-0">
        <i class="bi bi-heart-pulse me-2">Vital Signs</i>
      </h4>
    </div>

    {% if recorded_vitals %}
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle">
          <thead class="table-primary">
            <tr class="text-center">
              <th scope="col">#</th>
              <th scope="col">T&nbsp;¬∞C</th>
              <th scope="col">Weight (kg)</th>
              <th scope="col">BP</th>
              <th scope="col">Heart Rate</th>
              <th scope="col">Resp. Rate</th>
              <th scope="col">Blood Glucose</th>
              <th scope="col">O‚ÇÇ Sat (With O‚ÇÇ)</th>
              <th scope="col">O‚ÇÇ Sat (No O‚ÇÇ)</th>
              <th scope="col">Recorded Time</th>
              <th scope="col">Recorded By</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody class="text-center">
            {% for vital in recorded_vitals %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ vital.temperature }}</td>
              <td>{{ vital.weight }}</td>
              <td>{{ vital.blood_pressure }}</td>
              <td>{{ vital.heart_rate }}</td>
              <td>{{ vital.respiratory_rate }}</td>
              <td>{{ vital.blood_glucose }}</td>
              <td>{{ vital.oxygen_saturation_with_oxygen }}</td>
              <td>{{ vital.oxygen_saturation_no_oxygen }}</td>
              <td>{{ vital.recorded_at }}</td>
              <td>{{ vital.recorded_by }}</td>
<td>
  <a href="{% url 'add_vitals_doctor' patient.id %}" class="btn btn-primary btn-sm rounded-pill px-3">
    <i class="bi bi-plus-circle me-1">Add</i>
  </a>
</td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% else %}
    <div class="card-body text-center text-danger fw-semibold">
      <i class="bi bi-activity me-2"></i>
      No vitals recorded for {{ patient.full_name }} yet.
    </div>
    {% endif %}
  </div>
</div>


<!-- History Taking Status -->
<div class="card shadow-lg border-0 rounded-4 my-4">
  <div class="card-header bg-white text-primary text-center border-0 py-3">
    <h4 class="fw-bold mb-0">
      <i class="bi bi-clipboard2-pulse me-2"></i>History Taking
    </h4>
  </div>

  <div class="card-body p-4">
    {% if medical_record.historytaking %}
      <div class="table-responsive">
        <table class="table table-hover align-middle table-bordered">
          <thead class="table-light text-primary">
            <tr class="text-center">
              <th>Chief Complaint</th>
              <th>History of Present Illness (HPI)</th>
              <th>History of Past Illness</th>
            </tr>
          </thead>
          <tbody class="text-secondary">
            <tr>
              <td>{{ medical_record.historytaking.chief_complain }}</td>
              <td>{{ medical_record.historytaking.hpi }}</td>
              <td>{{ medical_record.historytaking.history_of_past_illness }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center mb-4">
        <span class="badge bg-warning text-dark px-3 py-2 fs-6 shadow-sm">
          <i class="bi bi-hourglass-split me-1"></i> Pending History Taking
        </span>
      </div>

      <!-- Add History Taking Form -->
      <form method="POST" action="{% url 'complete_history_taking' patient.id %}" class="mx-auto" style="max-width: 700px;">
        {% csrf_token %}
        
        <div class="mb-3">
          <label for="chief_complain" class="form-label fw-semibold text-primary">
            Chief Complaint
          </label>
          <textarea 
            name="chief_complain" 
            id="chief_complain" 
            class="form-control rounded-3 shadow-sm" 
            rows="2" 
            placeholder="Enter patient's main complaint..."
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="hpi" class="form-label fw-semibold text-primary">
            History of Present Illness (HPI)
          </label>
          <textarea 
            name="hpi" 
            id="hpi" 
            class="form-control rounded-3 shadow-sm" 
            rows="3" 
            placeholder="Describe the current illness history..."
          ></textarea>
        </div>

        <div class="mb-4">
          <label for="hpasti" class="form-label fw-semibold text-primary">
            History of Past Illness
          </label>
          <textarea 
            name="hpasti" 
            id="hpasti" 
            class="form-control rounded-3 shadow-sm" 
            rows="3" 
            placeholder="Include relevant past medical history..."
          ></textarea>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-success rounded-pill px-4">
            <i class="bi bi-save2 me-2"></i>Save Notes
          </button>
        </div>
      </form>
    {% endif %}
  </div>
</div>

<!-- Physical Examination Section -->
<div class="card shadow-sm mb-4 p-2">
  <div class="card-header bg-white text-primary text-center">
    <h4>Physical Examination</h4>
  </div>

  <div class="card-body">
    {% if medical_record.physicalexamination %}
    <!-- Display Saved Results -->
    <div id="exam-display">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">General Appearance</h6>
            <p>{{ medical_record.physicalexamination.general_appearance|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">HEENT</h6>
            <p>{{ medical_record.physicalexamination.heent|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">LGS</h6>
            <p>{{ medical_record.physicalexamination.lgs|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">Chest</h6>
            <p>{{ medical_record.physicalexamination.chest|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">CVS</h6>
            <p>{{ medical_record.physicalexamination.cvs|default:"‚Äî" }}</p>
          </div>
        </div>

        <div class="col-md-6">
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">Abdomen</h6>
            <p>{{ medical_record.physicalexamination.abdomen|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">GUS</h6>
            <p>{{ medical_record.physicalexamination.gus|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">MSS</h6>
            <p>{{ medical_record.physicalexamination.mss|default:"‚Äî" }}</p>
          </div>
          <div class="border rounded  mb-2 bg-light">
            <h6 class="text-secondary mb-1">CNS</h6>
            <p>{{ medical_record.physicalexamination.cns|default:"‚Äî" }}</p>
          </div>
        </div>
      </div>

      <div class="text-end mt-3">
        <button id="edit-btn" class="btn btn-outline-primary btn-sm">
          ‚úèÔ∏è Edit / Update Examination
        </button>
      </div>
    </div>
    {% endif %}

    <!-- Add or Edit Form -->
    <div id="exam-form" {% if medical_record.physicalexamination %}style="display:none"{% endif %}>
      <form method="POST" action="{% url 'complete_physical_examination' patient.id %}">
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">General Appearance</label>
            <textarea name="general_appearance" class="form-control form-control-sm" rows="2" placeholder="Describe general appearance...">{{ medical_record.physicalexamination.general_appearance|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">HEENT</label>
            <textarea name="heent" class="form-control form-control-sm" rows="2" placeholder="Head, Eyes, Ears, Nose, Throat...">{{ medical_record.physicalexamination.heent|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">LGS</label>
            <textarea name="lgs" class="form-control form-control-sm" rows="2" placeholder="Lymphatic and Glandular System...">{{ medical_record.physicalexamination.lgs|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">Chest</label>
            <textarea name="chest" class="form-control form-control-sm" rows="2" placeholder="Describe chest examination findings...">{{ medical_record.physicalexamination.chest|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">CVS</label>
            <textarea name="cvs" class="form-control form-control-sm" rows="2" placeholder="Cardiovascular System...">{{ medical_record.physicalexamination.cvs|default_if_none:'' }}</textarea>
          </div>

          <div class="col-md-6">
            <label class="form-label">Abdomen</label>
            <textarea name="abdomen" class="form-control form-control-sm" rows="2" placeholder="Describe abdominal findings...">{{ medical_record.physicalexamination.abdomen|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">GUS</label>
            <textarea name="gus" class="form-control form-control-sm" rows="2" placeholder="Genitourinary System...">{{ medical_record.physicalexamination.gus|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">MSS</label>
            <textarea name="mss" class="form-control form-control-sm" rows="2" placeholder="Musculoskeletal System...">{{ medical_record.physicalexamination.mss|default_if_none:'' }}</textarea>

            <label class="form-label mt-2">CNS</label>
            <textarea name="cns" class="form-control form-control-sm" rows="2" placeholder="Central Nervous System...">{{ medical_record.physicalexamination.cns|default_if_none:'' }}</textarea>
          </div>
        </div>

        <div class="text-end mt-4">
          <button type="submit" class="btn btn-success btn-sm">üíæ Save Examination</button>
          {% if medical_record.physicalexamination %}
          <button type="button" id="cancel-btn" class="btn btn-secondary btn-sm">‚úñ Cancel</button>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Toggle Logic -->
<script>
  const editBtn = document.getElementById("edit-btn");
  const cancelBtn = document.getElementById("cancel-btn");
  const displayDiv = document.getElementById("exam-display");
  const formDiv = document.getElementById("exam-form");

  if (editBtn) {
    editBtn.addEventListener("click", () => {
      displayDiv.style.display = "none";
      formDiv.style.display = "block";
    });
  }

  if (cancelBtn) {
    cancelBtn.addEventListener("click", () => {
      formDiv.style.display = "none";
      displayDiv.style.display = "block";
    });
  }
</script>


<!-- Diagnosis Section -->
<div class="card shadow-lg border-0 rounded-4 my-4">
  <div class="card-header bg-white text-primary text-center border-0 py-1">
    <h4 class="fw-bold mb-0">
      <i class="bi bi-heart-pulse me-2"></i>Diagnosis
    </h4>
  </div>

  <div class="card-body p-4">
    <form method="POST" action="{% url 'complete_diagnosis' patient.id %}">
      {% csrf_token %}
      <div class="mb-3">
        <label for="complete_diagnosis" class="form-label fw-semibold text-primary">
          Write Diagnosis
        </label>
        <textarea
          name="complete_diagnosis"
          id="complete_diagnosis"
          class="form-control shadow-sm border-0 bg-light rounded-3"
          rows="2"
          placeholder="Enter your clinical diagnosis or impressions here..."
        >{{ medical_record.diagnosis }}</textarea>
      </div>

      <div class="d-flex justify-content-center mt-3">
        <button type="submit" class="btn btn-success rounded-pill px-4 shadow-sm">
          <i class="bi bi-save2 me-2"></i>Save Diagnosis
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Investigations Section -->
<div class="card shadow-lg border-0 rounded-4 my-4">
  <div class="card-header bg-white text-primary text-center border-0 py-3">
    <h4 class="fw-bold mb-0">
      <i class="bi bi-flask me-2">Investigations</i>
    </h4>
  </div>

  <div class="card-body p-4">
    <div class="d-flex justify-content-center mb-4">
      <a href="{% url 'order_bulk_lab_test' patient.id %}" class="btn btn-success rounded-pill px-4 shadow-sm">
        <i class="bi bi-plus-circle me-2"></i>Order Investigations
      </a>
    </div>

    <div class="table-responsive">
      <table class="table table-hover align-middle table-bordered rounded-3 overflow-hidden">
        <thead class="table-light text-primary text-center">
          <tr>
            <th>#</th>
            <th>Investigation Name</th>
            <th>Payment Status</th>
            <th>Status</th>
            <th>Result</th>
            <th>All Results</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody class="text-center text-secondary">
          {% for ordered_investigation in ordered_investigations %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td class="fw-semibold text-dark">
              <i class="bi bi-beaker text-info me-1"></i>{{ ordered_investigation.name }}
            </td>

            <!-- Payment Status -->
            <td>
              {% if ordered_investigation.payment_status == "Completed" %}
                <span class="badge bg-success-subtle text-success border border-success rounded-pill px-3">
                  <i class="bi bi-check-circle me-1"></i>Paid
                </span>
              {% else %}
                <span class="badge bg-warning-subtle text-warning border border-warning rounded-pill px-3">
                  <i class="bi bi-exclamation-circle me-1"></i>Pending
                </span>
              {% endif %}
            </td>

            <!-- Status -->
            <td>
              {% if ordered_investigation.status == "Completed" %}
                <span class="badge bg-primary-subtle text-primary border border-primary rounded-pill px-3">
                  <i class="bi bi-check2-circle me-1"></i>Completed
                </span>
              {% else %}
                <span class="badge bg-secondary-subtle text-muted border border-secondary rounded-pill px-3">
                  <i class="bi bi-hourglass-split me-1"></i>{{ ordered_investigation.status }}
                </span>
              {% endif %}
            </td>

            <!-- View Result -->
            <td>
              {% if ordered_investigation.status == "Completed" %}
                <a href="{% url 'view_test_result' patient.id ordered_investigation.name %}" class="btn btn-outline-primary btn-sm rounded-pill px-3">
                  <i class="bi bi-file-earmark-medical me-1"></i>View
                </a>
              {% else %}
                <span class="text-muted">Not Available</span>
              {% endif %}
            </td>

            <!-- View All Results -->
            <td>
              {% if ordered_investigation.status == "Completed" %}
                <a href="{% url 'view_all_results' patient.id %}" class="btn btn-outline-info btn-sm rounded-pill px-3">
                  <i class="bi bi-collection me-1"></i>All
                </a>
              {% else %}
                <span class="text-muted">Not Available</span>
              {% endif %}
            </td>

            <!-- Actions -->
            <td>
              {% if ordered_investigation.payment_status == "Pending" %}
                <a href="#" class="btn btn-outline-danger btn-sm rounded-pill px-3"
                   onclick="return confirm('Are you sure you want to delete this test request?');">
                  <i class="bi bi-trash me-1"></i>Delete
                </a>
              {% else %}
                <span class="text-muted">No Action</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center text-danger py-3">
              <i class="bi bi-exclamation-triangle me-2"></i>No investigations ordered yet.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Prescriptions -->
<div class="container-fluid">
  <h4 class="text-primary bg-white text-center">Prescriptions</h4>
  <a href="{% url 'prescribe_prescription' medical_record.id %}" class="btn btn-success mb-3">
    Prescribe Medication
  </a>

  {% if prescriptions %}
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th style="width: 10%; text-align: center">S.No</th>
          <th style="width: 65%">Prescription</th>
          <th style="width: 25%; text-align: center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for prescription in prescriptions %}
        <tr>
          <td class="text-center">{{ forloop.counter }}</td>
          <td>{{ prescription.prescription_note }}</td>
          <td class="text-center">
            <!-- Delete Prescription Button -->
            <form
              method="post"
              action="{% url 'delete_prescription' prescription.id %}"
              class="d-inline"
              onsubmit="return confirm('Are you sure you want to delete this prescription?');"
            >
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-muted">No previous prescriptions available.</p>
  {% endif %}
</div>
<div class="d-flex justify-content-between align-items-center my-3">

  <!-- Back to Dashboard -->
  <a href="{% url 'doctor_view' %}" class="btn btn-success">
    Back to Dashboard
  </a>

  <!-- Doctor Actions -->
  <div class="d-flex gap-2">

    {# --- Admission Request Logic --- #}
    {% if patient.patient_type != 'inpatient' %}
      {% if not patient.admission_requested %}
        <!-- Request Admission -->
        <form method="POST" action="{% url 'request_admission' patient.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-door-open"></i> Request Admission
          </button>
        </form>
      {% else %}
        <!-- Cancel Admission Request -->
        <form method="POST" action="{% url 'cancel_admission_request' patient.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger">
            <i class="bi bi-x-circle"></i> Cancel Admission Request
          </button>
        </form>
      {% endif %}
    {% endif %}

    {# --- Discharge Request Logic --- #}
    {% if patient.patient_type == 'inpatient' %}
      {% if not patient.discharge_requested %}
        <form method="POST" action="{% url 'request_discharge' patient.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-warning">
            <i class="bi bi-box-arrow-up-right"></i> Request Discharge
          </button>
        </form>
      {% else %}
        <button class="btn btn-outline-secondary" disabled>
          Discharge Requested
        </button>
      {% endif %}
    {% endif %}

    {# --- Close Patient Case Logic --- #}
    {% if patient.patient_type == 'inpatient' or patient.admission_requested %}
      <button class="btn btn-outline-secondary" disabled>
        Cannot Close While Admitted or Admission Pending
      </button>
    {% else %}
      
      <form method="POST" action="{% url 'create_or_edit_referral' patient.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-warning">
          <i class="bi bi-x-lg"></i> Refer Patient
        </button>
      </form>
      <form method="POST" action="{% url 'close_patient_case' patient.id %}" onsubmit="return confirmCloseCase();">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
          <i class="bi bi-x-lg"></i> Close Patient Medical Case
        </button>
      </form>
    {% endif %}

  </div>

</div>
  <script>
    function confirmCloseCase() {
      return confirm(
        "Are you sure you want to close this patient's medical case?"
      );
    }
  </script>

  <!-- JavaScript for dynamic category-test filtering -->

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const categorySelect = document.getElementById("service_category");
      const serviceSelect = document.getElementById("services");

      categorySelect.addEventListener("change", function () {
        const categoryId = categorySelect.value;

        // Disable Service dropdown and reset options
        serviceSelect.innerHTML = '<option value="">Choose a service</option>';
        serviceSelect.disabled = true; // Disable the dropdown while loading

        if (categoryId) {
          // Show loading indication (optional)
          serviceSelect.innerHTML = "<option>Loading...</option>";

          fetch(`/patient/get_services_by_category/${categoryId}/`) // Ensure correct URL pattern
            .then((response) => response.json())
            .then((data) => {
              if (data.services && data.services.length > 0) {
                data.services.forEach((service) => {
                  const option = document.createElement("option");
                  option.value = service.id;
                  option.textContent = service.name;
                  serviceSelect.appendChild(option);
                });
                serviceSelect.disabled = false; // Enable the dropdown after loading
              } else {
                serviceSelect.innerHTML =
                  "<option>No services available</option>";
                serviceSelect.disabled = true; // Disable if no services found
              }
            })
            .catch((error) => {
              console.error("Error fetching services:", error);
              serviceSelect.innerHTML =
                "<option>Error loading services</option>";
              serviceSelect.disabled = true; // Disable dropdown if error
            });
        }
      });
    });
  </script>
</div>

{%endblock%}

