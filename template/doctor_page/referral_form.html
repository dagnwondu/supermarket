{% extends 'doctor_page/doctor_base.html' %}
{% load static %}
{% block content %}

<div class="container mt-4">
  <h4 class="text-center mb-3">Patient Referral Form</h4>

  <!-- Patient Info -->
  <div class="mb-4 border rounded p-3 bg-light">
    <p><strong>Patient:</strong> {{ patient.full_name }}</p>
    <p><strong>Age:</strong> {{ patient.age }} | <strong>Sex:</strong> {{ patient.gender }}</p>
    <p><strong>Phone:</strong> {{ patient.phone_number }}</p>
  </div>

  <!-- Success Messages -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <!-- Referral Form -->
  <form method="POST" class="border rounded p-4 shadow-sm bg-white">
    {% csrf_token %}

    <div class="row mb-3">
      <div class="col-md-6">
        <label class="form-label fw-bold">Receiving Facility</label>
        <input type="text" name="receiving_facility" class="form-control"
               value="{{ referral.receiving_facility|default_if_none:'' }}" required>
      </div>
      <div class="col-md-6">
        <label class="form-label fw-bold">Referred To (Doctor/Department)</label>
        <input type="text" name="referred_to" class="form-control"
               value="{{ referral.referred_to|default_if_none:'' }}" required>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Contact Information</label>
      <input type="text" name="contact_info" class="form-control"
             value="{{ referral.contact_info|default_if_none:'' }}" required>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Brief Description</label>
      <textarea name="brief_description" class="form-control" rows="3" required>{{ referral.brief_description|default_if_none:'' }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Reason for Referral</label>
      <textarea name="reason_for_referral" class="form-control" rows="3" required>{{ referral.reason_for_referral|default_if_none:'' }}</textarea>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-primary">Save Referral</button>
    </div>
  </form>

  <!-- Print Button -->
  {% if referral %}
    <div class="text-center mt-4">
      <a href="{% url 'print_referral' referral.id %}" target="_blank" class="btn btn-success">
        üñ®Ô∏è Print Referral
      </a>
    </div>
  {% endif %}
</div>

{% endblock %}
