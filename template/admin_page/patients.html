{% extends 'admin_page/admin_base.html' %}
{% block content %}
<style>
  .hover-bg-primary:hover {
    background-color: #cfe2ff !important;
  }
  .hover-bg-warning:hover {
    background-color: #fff3cd !important;
  }
  .hover-bg-danger:hover {
    background-color: #f8d7da !important;
  }
  .hover-bg-success:hover {
    background-color: #d1e7dd !important;
  }
</style>
        {% if messages %}
            <div class="mt-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

{% if page_obj %}
<div class="container-fluid">
  <div class="col">
    <table class="table table-striped table-hover table-bordered">
      <thead>
        <tr>
          <th>S.No</th>
          <th>Full Name</th>
          <th>MRN</th>
          <th>Type</th>
          <th>Gender</th>
          <th>Age</th>
          <th>Mobile</th>
          <th>Address</th>
          <th>Registered By</th>
          <th>Is Active?</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for patient in page_obj %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ patient.full_name }}</td>
          <td>{{ patient.card_number }}</td>
          <td>{{ patient.patient_type }}</td>
          <td>{{ patient.gender }}</td>
          <td>{{ patient.age }}</td>
          <td>{{ patient.phone_number }}</td>
          <td>{{ patient.region }}, {{ patient.town }}, {{ patient.kebele }}</td>
          <td>{{ patient.registered_by }}</td>
          <td style="color: {{ patient.is_active|yesno:'green,red' }}">{{ patient.is_active }}</td>
          <td>
            <div class="dropdown">
              <button
                class="btn btn-sm btn-primary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Select Action
              </button>
              <ul class="dropdown-menu">
                <a
                  class="dropdown-item text-primary hover-bg-primary"
                  href="#"
                  onclick="handleAction('update_patient_admin', {{ patient.id }})"
                >Update</a>

                {% if patient.is_active %}
                <a
                  class="dropdown-item text-warning hover-bg-warning"
                  href="#"
                  onclick="handleAction('deactivate_patient_admin', {{ patient.id }})"
                >Deactivate</a>
                {% else %}
                <a
                  class="dropdown-item text-success hover-bg-success"
                  href="#"
                  onclick="handleAction('activate_patient_admin', {{ patient.id }})"
                >Activate</a>
                {% endif %}

                <a
                  class="dropdown-item text-danger hover-bg-danger"
                  href="#"
                  onclick="handleAction('delete_patient_admin', {{ patient.id }})"
                >Delete</a>
              </ul>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="container">
  <p>No patients found.</p>
</div>
{% endif %}

<!-- Pagination -->
<div class="container">
  <div class="d-flex justify-content-center">
    <ul class="pagination">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page=1">&laquo; First</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      </li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
      </li>

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
      </li>
      {% endif %}
    </ul>
  </div>
</div>

<!-- Action Handler Script -->
<script>
  function handleAction(action, id) {
    if (!action || !id) return;

    const baseUrl = `/patient/${id}/`;
    let confirmMessage = "";

    switch (action) {
      case "update":
        confirmMessage = "Are you sure you want to update this patient?";
        break;
      case "deactivate":
        confirmMessage = "Are you sure you want to deactivate this patient?";
        break;
      case "activate":
        confirmMessage = "Are you sure you want to activate this patient?";
        break;
      case "delete":
        confirmMessage = "Are you sure you want to delete this patient?";
        break;
    }

    if (confirm(confirmMessage)) {
      window.location.href = baseUrl + action + "/";
    }
  }
</script>
{% endblock %}
