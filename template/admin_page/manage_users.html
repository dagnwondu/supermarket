{% extends 'admin_page/admin_base.html'%} {% block content %}

<h6>Welcome: {{ user }}</h6>
<h5 style="text-align: center">Manage Users</h5>

{% if messages %}
<div class="alert alert-info">
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }}</div>
  {% endfor %}
</div>
{% endif %}

<!-- Button to trigger the modal -->
<div class="container">
  <button
    type="button"
    class="btn btn-success btn-sm"
    data-bs-toggle="modal"
    data-bs-target="#addUserModal"
  >
    Add New User
  </button>
</div>
<!-- Modal for adding new user -->
<!-- Modal for adding new user -->
<div
  class="modal fade"
  id="addUserModal"
  tabindex="-1"
  aria-labelledby="addUserModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <!-- User Form Fields -->
          <div class="mb-3">
            <label
              for="{{ user_form.username.id_for_label }}"
              class="form-label"
              >{{ user_form.username.label }}</label
            >
            {{ user_form.username }}
          </div>

          <div class="mb-3">
            <label
              for="{{ user_form.first_name.id_for_label }}"
              class="form-label"
              >{{ user_form.first_name.label }}</label
            >
            {{ user_form.first_name }}
          </div>
          <div class="mb-3">
            <label
              for="{{ user_form.last_name.id_for_label }}"
              class="form-label"
              >{{ user_form.last_name.label }}</label
            >
            {{ user_form.last_name }}
          </div>
          <div class="mb-3">
            <label for="{{ user_form.email.id_for_label }}" class="form-label"
              >{{ user_form.email.label }}</label
            >
            {{ user_form.email }}
          </div>
          <div class="mb-3">
            <label
              for="{{ user_form.password.id_for_label }}"
              class="form-label"
              >{{ user_form.password.label }}</label
            >
            {{ user_form.password }}
          </div>
          <div class="mb-3">
            <label
              for="{{ user_form.user_type.id_for_label }}"
              class="form-label"
              >{{ user_form.user_type.label }}</label
            >
            {{ user_form.user_type }}
          </div>
          <div class="mb-3">
            <label
              for="{{ user_form.phone_number.id_for_label }}"
              class="form-label"
              >{{ user_form.phone_number.label }}</label
            >
            {{ user_form.phone_number }}
          </div>
          <div class="mb-3">
            <label for="{{ user_form.address.id_for_label }}" class="form-label"
              >{{ user_form.address.label }}</label
            >
            {{ user_form.address }}
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button type="submit" class="btn btn-primary">Add User</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- User Table -->
<div class="container">
  <div class="col">
    <table class="table table-striped table-hover table-bordered">
      <tr>
        <th scope="col">S.No</th>
        <th scope="col">Username</th>
        <th scope="col">User First Name</th>
        <th scope="col">User Middle Name</th>
        <th scope="col">User Last Name</th>
        <th scope="col">User Role</th>
        <th scope="col">Email</th>
        <th scope="col">Is Active</th>
        <th scope="col">Actions</th>
        <th scope="col">Change Password</th>
        <!-- New column -->
        <th scope="col">Edit Info</th>
        <!-- New column -->
      </tr>

      {% for user in users %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.first_name }}</td>
        <td>{{ user.middle_name }}</td>
        <td>{{ user.last_name }}</td>
        <td>{{ user.user_type }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.is_active }}</td>
        <td>
          <form
            method="post"
            action="{% url 'delete_user' user.id %}"
            onsubmit="return confirm('Are you sure you want to delete this user?');"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
          </form>
        </td>

        <td>
          <!-- Button to trigger the password change modal -->
          <button
            type="button"
            class="btn btn-warning btn-sm"
            data-bs-toggle="modal"
            data-bs-target="#changePasswordModal{{ user.id }}"
          >
            Change Password
          </button>
        </td>
        <td>
          <form method="post" action="{% url 'update_user' user.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-sm">Update</button>
          </form>
        </td>
      </tr>

      <!-- Modal for changing password -->
      <div
        class="modal fade"
        id="changePasswordModal{{ user.id }}"
        tabindex="-1"
        aria-labelledby="changePasswordModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="POST" action="{% url 'change_password' user.id %}">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title" id="changePasswordModalLabel">
                  Change Password for {{ user.username }}
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="new_password" class="form-label"
                    >New Password</label
                  >
                  <input
                    type="password"
                    name="new_password"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="confirm_password" class="form-label"
                    >Confirm Password</label
                  >
                  <input
                    type="password"
                    name="confirm_password"
                    class="form-control"
                    required
                  />
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Close
                </button>
                <button type="submit" class="btn btn-primary">
                  Change Password
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </table>
  </div>
</div>

{% endblock %}
